v {xschem version=3.4.5 file_version=1.2
}
G {}
K {}
V {}
S {}
E {}
N 2440 -2410 2440 -2380 {
lab=VDD}
N 2440 -1900 2440 -1870 {
lab=VSS}
N 1860 -2330 1890 -2330 {
lab=VCONT}
N 2510 -2130 2540 -2130 {
lab=#net1}
N 2540 -2130 2570 -2130 {
lab=#net1}
N 2860 -2130 2860 -2110 {
lab=Vdel}
N 2730 -2130 2860 -2130 {
lab=Vdel}
N 1820 -2330 1820 -2320 {
lab=VCONT}
N 1820 -2260 1820 -2240 {
lab=VSS}
N 1820 -2330 1860 -2330 {
lab=VCONT}
N 1810 -2330 1820 -2330 {
lab=VCONT}
N 2730 -1890 2730 -1870 {
lab=GND}
N 2730 -1970 2730 -1950 {
lab=Vin}
N 2350 -2120 2360 -2120 {
lab=Vin}
N 2620 -2130 2620 -2090 {
lab=Vdel}
N 2620 -2200 2620 -2130 {
lab=Vdel}
N 2620 -2060 2630 -2060 {
lab=VSS}
N 2630 -2060 2630 -2030 {
lab=VSS}
N 2620 -2030 2630 -2030 {
lab=VSS}
N 2620 -2230 2640 -2230 {
lab=VDD}
N 2640 -2260 2640 -2230 {
lab=VDD}
N 2620 -2260 2640 -2260 {
lab=VDD}
N 2620 -2130 2630 -2130 {
lab=Vdel}
N 2570 -2230 2580 -2230 {
lab=#net1}
N 2570 -2230 2570 -2060 {
lab=#net1}
N 2570 -2060 2580 -2060 {
lab=#net1}
N 2620 -2030 2620 -1980 {
lab=VSS}
N 2620 -2280 2620 -2260 {
lab=VDD}
N 2630 -2130 2740 -2130 {
lab=Vdel}
N 2620 -2010 2860 -2010 {
lab=VSS}
N 2860 -2050 2860 -2010 {
lab=VSS}
N 2860 -2160 2860 -2130 {
lab=Vdel}
N 2360 -2180 2400 -2180 { lab=Vin}
N 2360 -2180 2360 -2070 { lab=Vin}
N 2360 -2070 2400 -2070 { lab=Vin}
N 2440 -2130 2440 -2100 { lab=#net1}
N 2440 -2180 2470 -2180 { lab=VDD}
N 2440 -2070 2470 -2070 { lab=VSS}
N 2470 -2050 2470 -1940 { lab=VSS}
N 2440 -2130 2500 -2130 { lab=#net1}
N 2440 -1900 2440 -1890 {
lab=VSS}
N 2440 -2370 2440 -2360 {
lab=VDD}
N 2440 -2370 2470 -2370 {
lab=VDD}
N 2470 -2290 2470 -2180 {
lab=VDD}
N 2440 -2330 2470 -2330 {
lab=VDD}
N 2440 -1900 2470 -1900 {
lab=VSS}
N 2470 -1940 2470 -1900 {
lab=VSS}
N 2440 -1940 2470 -1940 {
lab=VSS}
N 2250 -2310 2400 -2310 {
lab=VCP}
N 2190 -2350 2190 -2340 {
lab=VDD}
N 2190 -2370 2440 -2370 {
lab=VDD}
N 2220 -1900 2440 -1900 {
lab=VSS}
N 2190 -1910 2190 -1900 {
lab=VSS}
N 1990 -1940 2150 -1940 {
lab=VCN}
N 1930 -1900 2190 -1900 {
lab=VSS}
N 1930 -1910 1930 -1900 {
lab=VSS}
N 1930 -2000 1930 -1970 {
lab=VCN}
N 2160 -2370 2190 -2370 {
lab=VDD}
N 1930 -2370 1930 -2360 {
lab=VDD}
N 1990 -2000 1990 -1940 {
lab=VCN}
N 1930 -2000 1990 -2000 {
lab=VCN}
N 2190 -2260 2250 -2260 {
lab=VCP}
N 2250 -2310 2250 -2260 {
lab=VCP}
N 2190 -1940 2220 -1940 {
lab=VSS}
N 2220 -1940 2220 -1900 {
lab=VSS}
N 2150 -1980 2150 -1940 {
lab=VCN}
N 2150 -1980 2400 -1980 {
lab=VCN}
N 2400 -1980 2400 -1940 {
lab=VCN}
N 1910 -1940 1930 -1940 {
lab=VSS}
N 1910 -1940 1910 -1900 {
lab=VSS}
N 1910 -1900 1930 -1900 {
lab=VSS}
N 1930 -2330 1960 -2330 {
lab=VDD}
N 1960 -2370 1960 -2330 {
lab=VDD}
N 2160 -2310 2190 -2310 {
lab=VDD}
N 2160 -2350 2160 -2310 {
lab=VDD}
N 2440 -2150 2440 -2130 { lab=#net1}
N 2440 -2380 2440 -2370 {
lab=VDD}
N 2470 -2370 2470 -2330 {
lab=VDD}
N 2440 -1910 2440 -1900 {
lab=VSS}
N 1970 -1940 1990 -1940 {
lab=VCN}
N 2190 -2280 2190 -2260 {
lab=VCP}
N 2230 -2310 2250 -2310 {
lab=VCP}
N 2190 -1900 2220 -1900 {
lab=VSS}
N 1930 -2370 1960 -2370 {
lab=VDD}
N 2090 -2370 2160 -2370 {
lab=VDD}
N 2060 -2370 2090 -2370 {
lab=VDD}
N 1960 -2370 2060 -2370 {
lab=VDD}
N 1930 -2300 1930 -2270 {
lab=#net2}
N 2400 -2330 2400 -2310 {
lab=VCP}
N 2160 -2370 2160 -2350 {
lab=VDD}
N 2190 -2370 2190 -2350 {
lab=VDD}
N 2060 -1950 2060 -1940 {
lab=VCN}
N 2320 -2320 2320 -2310 {
lab=VCP}
N 1930 -2230 1930 -2180 {
lab=#net2}
N 1930 -2100 1930 -2000 {
lab=VCN}
N 2440 -2300 2440 -2280 {
lab=#net3}
N 2440 -2220 2440 -2210 {
lab=#net4}
N 2470 -2330 2470 -2290 {
lab=VDD}
N 2190 -2260 2190 -2210 {
lab=VCP}
N 1930 -2270 1930 -2230 {
lab=#net2}
N 2470 -2070 2470 -2050 {
lab=VSS}
N 2440 -2040 2440 -2030 {
lab=#net5}
N 2190 -2210 2190 -2200 {
lab=VCP}
N 1930 -2120 1930 -2100 {
lab=VCN}
N 2190 -2200 2190 -2180 {
lab=VCP}
N 2190 -2120 2190 -1970 {
lab=#net6}
N 2500 -2130 2520 -2130 {
lab=#net1}
C {devices/lab_pin.sym} 2440 -2410 1 0 {name=p13 sig_type=std_logic lab=VDD}
C {devices/lab_pin.sym} 2440 -1870 3 0 {name=p14 sig_type=std_logic lab=VSS}
C {devices/lab_pin.sym} 1810 -2330 2 1 {name=p15 sig_type=std_logic lab=VCONT}
C {code.sym} 3010 -2300 0 0 {name=MODEL1 only_toplevel=true spice_ignore=false
format="tcleval( @value )"
value="
.lib /opt/pdks/sky130A/libs.tech/ngspice/sky130.lib.spice tt
*.lib /opt/pdks/sky130A/libs.tech/ngspice/sky130.lib.spice ss
*.lib /opt/pdks/sky130A/libs.tech/ngspice/sky130.lib.spice ff
*.lib /opt/pdks/sky130A/libs.tech/ngspice/sky130.lib.spice sf
*.lib /opt/pdks/sky130A/libs.tech/ngspice/sky130.lib.spice fs
"}
C {code.sym} 3010 -2150 0 0 {name=SimParameters1 only_toplevel=true spice_ignore=false
format="tcleval( @value )"
value="
.param Co = 0.1p
*.param Co = 0.1p
.param mult = 1
.param w_buf = 1
.param l_buf = 0.15

.param Vcont = 0
.param VCP = 0
.param VCN =1.8

vvdd vdd 0 dc 1.8
vvss vss 0 0
*vvcont VCONT 0 dc 0
*vvcont2 VCONT2 0 dc 0
*.option temp = 200
.ic v(V_1) = 0
.ic v(V_2) = 1.8
.save v(V_1) v(Vo)


.param VH = 1.8

.ic v(Vo) = 0

*.param fsw = 10Meg
*.param fsw = 8.4Meg
.param fsw = 1Meg
*.param fsw = 100k

.param T = 1/fsw

.param D = 0.5
.param TR = 1n
.param TF = 1n
.param TdR = 0.5n
.param TdF = 0.5n

.param SimTime =  30*T
.csparam SimTime =\{Simtime\}
.csparam Tmargin = 10u


"}
C {capa.sym} 2860 -2080 0 0 {name=C2
m=1
value=\{Co\}
footprint=1206
device="ceramic capacitor"}
C {devices/code.sym} 3140 -2300 0 0 {name=SweepVcont only_toplevel=false spice_ignore=false
value="
.save all
.tran 5n \{SimTime\}
.csparam start = 10
.control
let Vtarg = 0.9
compose vin_var start=0 stop=0.8 step=0.1

let strt = 0
let stp = 0.8
let step = 0.1
let len2 = 1 + (stp-strt)/step
let Del_sweep = vector(len2)
let DelStarv_sweep = vector(len2)
let index = 0
foreach val $&vin_var
	alter vcont $val
	let f_sum = 0
	let t_act = 0
	let period_cont = 1
	let period_cont2 = 2
	run
	meas tran Tdel TRIG v(Vin) VAL = \{Vtarg\} RISE = 20 TARG v(Vdel) VAL = \{Vtarg\}  RISE = 20
	*meas tran TdelStarved TRIG v(Vin) VAL = \{Vtarg\} RISE = 20 TARG v(Vdel_starved) VAL = \{Vtarg\}  RISE = 20

	let Del_sweep[index] = Tdel
	let index = index +1
end
plot tran1.v(Vdel) 
plot tran8.v(Vdel)

print Del_sweep
plot Del_sweep vs vin_var
.endc
"}
C {vsource.sym} 1820 -2290 0 0 {name=Vcont value=\{Vcont\} savecurrent=false}
C {devices/lab_pin.sym} 1820 -2240 3 0 {name=p16 sig_type=std_logic lab=VSS}
C {code.sym} 3010 -2000 0 0 {name=VCO_param2 only_toplevel=true spice_ignore=true
format="tcleval( @value )"
value="

.param w_MP1 = 0.5
.param l_MP1 = 7
.param w_MP2 = 8
.param l_MP2 = 4
.param w_MP3 = 5
.param l_MP3 = 4
.param w_MP4 = 3
.param l_MP4 = 0.15

.param w_MN1 = 5
.param l_MN1 = 0.5
.param w_MN2 = 5
.param l_MN2 = 0.5
.param w_MN3 = 3
.param l_MN3 = 0.5
.param w_MN4 = 1
.param l_MN4 = 0.15


"}
C {gnd.sym} 2730 -1870 0 0 {name=l1 lab=GND}
C {vsource.sym} 2730 -1920 0 0 {name=Vg2 value="PULSE(0 \{VH\} 0 \{TR\} \{TF\} \{T*D\} \{T\} 0)" savecurrent=false}
C {devices/lab_pin.sym} 2730 -1970 2 0 {name=p17 sig_type=std_logic lab=Vin}
C {devices/lab_pin.sym} 2350 -2120 2 1 {name=p18 sig_type=std_logic lab=Vin}
C {sky130_fd_pr/nfet_01v8.sym} 2600 -2060 0 0 {name=M5
W=\{w_buf\}
L=\{l_buf\}
nf=1
mult=\{mult\}
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8.sym} 2600 -2230 0 0 {name=M6
W=\{w_buf\}
L=\{l_buf\}
nf=1
mult=\{mult*3\}
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8
spiceprefix=X
}
C {devices/lab_pin.sym} 2620 -1980 3 0 {name=p19 sig_type=std_logic lab=VSS}
C {devices/lab_pin.sym} 2620 -2280 1 0 {name=p20 sig_type=std_logic lab=VDD}
C {devices/lab_pin.sym} 2860 -2160 2 1 {name=p21 sig_type=std_logic lab=Vdel}
C {devices/code.sym} 3150 -2150 0 0 {name=DCSim1 only_toplevel=false spice_ignore=true
value="
.save all
.csparam start = 10
.control
alter Vg1 = 0
dc Vcont 0 1 0.01 
let Icont = i(v.x1.VIcont)
let Iout = i(v.x1.VIout)
let VCN = v(x1.VCN)
let VCP = v(x1.VCP)
let  Vin = v(Vin)

plot Icont vs Vcont
plot Iout vs VCP
plot VCP vs Vcont
plot VCN vs Vcont
*plot Vin vs Vcont

.endc
"}
C {code.sym} 3150 -2000 0 0 {name=VCO_param3 only_toplevel=true spice_ignore=true
format="tcleval( @value )"
value="

.param w_MP1 = 4
.param l_MP1 = 7
.param w_MP2 = 8
.param l_MP2 = 4
.param w_MP3 = 5
.param l_MP3 = 4
.param w_MP4 = 5
.param l_MP4 = 5

.param w_MN1 = 5
.param l_MN1 = 0.5
.param w_MN2 = 5
.param l_MN2 = 0.5
.param w_MN3 = 3
.param l_MN3 = 0.5
.param w_MN4 = 2
.param l_MN4 = 5


"}
C {devices/code.sym} 3260 -2150 0 0 {name=TranSim only_toplevel=false spice_ignore=true
value="
.save all
.tran 5n \{SimTime\}
.control
run
let Vtarg = 0.9
*let Vo = v(Vo)
let VCN_tran = v(VCN)
let VCP_tran = v(VCP)
let Icont_tran = i(VIcont)
let Iout_tran = i(VIp)
let In_tran  = i(VIn)

meas tran VCN AVG VCN_tran FROM=0 TO=\{SimTime\}
meas tran VCP AVG VCP_tran FROM=0 TO=\{SimTime\}
meas tran Icont AVG Icont_tran FROM=0 TO=\{SimTime\}
meas tran Iout AVG Iout_tran FROM=0 TO=\{SimTime\}

meas tran Tdel TRIG Vin VAL = \{Vtarg\} RISE = 20 TARG v(Vdel) VAL = \{Vtarg\}  RISE = 20
*meas tran TdelStarved TRIG Vin VAL = \{Vtarg\} RISE = 20 TARG v(Vdel_starved) VAL = \{Vtarg\}  RISE = 20

*plot Vo
plot Vdel+2 Vin
plot VCN_tran VCP_tran
*plot Icont_tran 
*plot Iout_tran
print VCN VCP Icont Iout
	
.endc
"}
C {code.sym} 3280 -2000 0 0 {name=VCO_param_V4 only_toplevel=true spice_ignore=true
format="tcleval( @value )"
value="

.param w_MP1 = 1
.param l_MP1 = 3
.param w_MP2 = 1
.param l_MP2 = 2
.param w_MP3 = 50
.param l_MP3 = 1
.param w_MP4 = 5
.param l_MP4 = 5

.param w_MN1 = 1
.param l_MN1 = 4
.param w_MN2 = w_MN1
.param l_MN2 = l_MN1
.param w_MN3 = 3
.param l_MN3 = 0.5
.param w_MN4 = 2
.param l_MN4 = 5


"}
C {code.sym} 3420 -2000 0 0 {name=VCO_param_V3 only_toplevel=true spice_ignore=false
format="tcleval( @value )"
value="

.param w_MP1 = 1
.param l_MP1 = 3
.param w_MP2 = 1
.param l_MP2 = 2
.param w_MP3 = 2
.param l_MP3 = 2
.param w_MP4 = 2
.param l_MP4 = 2

.param w_MN1 = 1
.param l_MN1 = 4
.param w_MN2 = w_MN1
.param l_MN2 = l_MN1
.param w_MN3 = 2
.param l_MN3 = 4
.param w_MN4 = 2
.param l_MN4 = 4


"}
C {code.sym} 3010 -1850 0 0 {name=VCO_param_DelayCell only_toplevel=true spice_ignore=true
format="tcleval( @value )"
value="

.param w_MP1 = 1
.param l_MP1 = 3
.param w_MP2 = 1
.param l_MP2 = 2
.param w_MP3 = 10
.param l_MP3 = 0.15
.param w_MP4 = 3
.param l_MP4 = 0.15

.param w_MN1 = 1
.param l_MN1 = 4
.param w_MN2 = w_MN1
.param l_MN2 = l_MN1
.param w_MN3 = 2
.param l_MN3 = 4
.param w_MN4 = 1
.param l_MN4 = 0.15


"}
C {sky130_fd_pr/pfet_01v8.sym} 1910 -2330 0 0 {name=MP1
W= \{w_MP1\}
L= \{l_MP1\}
nf=1
mult= 1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8.sym} 2210 -2310 0 1 {name=MP2
W= \{w_MP2\}
L= \{l_MP2\}
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8.sym} 2420 -2330 0 0 {name=MP3
W=\{w_MP3\}
L=\{l_MP3\}
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/pfet_01v8.sym} 2420 -2180 0 0 {name=MP4
W=\{w_MP4\}
L=\{l_MP4\}
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/nfet_01v8.sym} 1950 -1940 0 1 {name=MN1
W=\{w_MN1\}
L=\{l_MN1\}
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/nfet_01v8.sym} 2170 -1940 0 0 {name=MN2
W=\{w_MN2\}
L=\{l_MN2\}
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/nfet_01v8.sym} 2420 -1940 0 0 {name=MN3
W=\{w_MN3\}
L=\{l_MN3\}
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8
spiceprefix=X
}
C {sky130_fd_pr/nfet_01v8.sym} 2420 -2070 0 0 {name=MN4
W=\{w_MN4\}
L=\{l_MN4\}
nf=1
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8
spiceprefix=X
}
C {lab_wire.sym} 2060 -1950 0 0 {name=p6 sig_type=std_logic lab=VCN}
C {lab_wire.sym} 2320 -2320 0 0 {name=p7 sig_type=std_logic lab=VCP}
C {ammeter.sym} 1930 -2150 0 0 {name=VIcont savecurrent=true spice_ignore=0}
C {ammeter.sym} 2440 -2250 0 1 {name=VIp savecurrent=true spice_ignore=0}
C {ammeter.sym} 2440 -2000 0 1 {name=VIn savecurrent=true spice_ignore=0}
C {ammeter.sym} 2190 -2150 0 0 {name=VIcont1 savecurrent=true spice_ignore=0}
