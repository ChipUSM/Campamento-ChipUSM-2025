v {xschem version=3.4.5 file_version=1.2
}
G {}
K {}
V {}
S {}
E {}
T {
} 1710 -950 0 0 0.4 0.4 {}
T {lv_nmos/lv_pmos 1.8V 
Vds = [0:1.95]
Vgs = [0:1.95]
Vbs = [0.3:-1.95]
l_min = 0.15u; l_max = 10u;
w_min = 0.42u; w_max = 10u?

5v0d10v0_pmos/nmos 

Vds = [0:10.5]
Vgs = [0:5]
Vbs = [0.3:-1.95]
l_min = 0.5u; l_max = 10u;
w_min = 0.42u; w_max = 10u?
} 1630 -1550 0 0 0.4 0.4 {}
N 2340 -1170 2340 -1160 {
lab=GND}
N 2490 -1570 2490 -1560 {
lab=Vdd}
N 2320 -1200 2340 -1200 {
lab=GND}
N 2320 -1200 2320 -1160 {
lab=GND}
N 2320 -1160 2340 -1160 {
lab=GND}
N 2490 -1530 2520 -1530 {
lab=Vdd}
N 2520 -1570 2520 -1530 {
lab=Vdd}
N 2380 -1200 2400 -1200 {
lab=VdsMN1}
N 2490 -1570 2520 -1570 {
lab=Vdd}
N 2490 -1490 2490 -1470 {
lab=VdMP1a}
N 2230 -1290 2230 -1280 {
lab=VdsMN1}
N 2340 -1160 2340 -1140 {
lab=GND}
N 2470 -1490 2490 -1490 {
lab=VdMP1a}
N 2520 -1580 2520 -1570 {
lab=Vdd}
N 2090 -1550 2090 -1530 {
lab=VgMP1}
N 2310 -1300 2310 -1290 {
lab=VdsMN1}
N 2400 -1290 2400 -1200 {
lab=VdsMN1}
N 2250 -1570 2250 -1560 {
lab=Vdd}
N 2250 -1530 2280 -1530 {
lab=Vdd}
N 2280 -1570 2280 -1530 {
lab=Vdd}
N 2250 -1570 2280 -1570 {
lab=Vdd}
N 2250 -1490 2250 -1470 {
lab=#net1}
N 2280 -1580 2280 -1570 {
lab=Vdd}
N 2380 -1550 2380 -1530 {
lab=VgMP1}
N 2190 -1530 2210 -1530 {
lab=#net1}
N 2190 -1530 2190 -1490 {
lab=#net1}
N 2490 -1410 2490 -1400 {
lab=VdMP1}
N 2410 -1400 2490 -1400 {
lab=VdMP1}
N 2250 -1410 2250 -1400 {
lab=VdMP1}
N 2310 -1290 2400 -1290 {
lab=VdsMN1}
N 2490 -1150 2490 -1140 {
lab=GND}
N 2470 -1180 2490 -1180 {
lab=GND}
N 2470 -1180 2470 -1140 {
lab=GND}
N 2470 -1140 2490 -1140 {
lab=GND}
N 2530 -1180 2550 -1180 {
lab=VgMN1}
N 2490 -1140 2490 -1120 {
lab=GND}
N 2400 -1290 2490 -1290 {
lab=VdsMN1}
N 2490 -1290 2490 -1270 {
lab=VdsMN1}
N 2020 -1420 2020 -1400 {
lab=VgMN1}
N 2750 -1170 2750 -1160 {
lab=GND}
N 2730 -1200 2750 -1200 {
lab=GND}
N 2730 -1200 2730 -1160 {
lab=GND}
N 2730 -1160 2750 -1160 {
lab=GND}
N 2790 -1200 2810 -1200 {
lab=VdsMN1}
N 2750 -1160 2750 -1140 {
lab=GND}
N 2720 -1300 2720 -1290 {
lab=VdsMN1}
N 2810 -1290 2810 -1200 {
lab=VdsMN1}
N 2720 -1290 2810 -1290 {
lab=VdsMN1}
N 2900 -1150 2900 -1140 {
lab=GND}
N 2880 -1180 2900 -1180 {
lab=GND}
N 2880 -1180 2880 -1140 {
lab=GND}
N 2880 -1140 2900 -1140 {
lab=GND}
N 2940 -1180 2960 -1180 {
lab=VgMN1}
N 2900 -1140 2900 -1120 {
lab=GND}
N 2810 -1290 2900 -1290 {
lab=VdsMN1}
N 2900 -1290 2900 -1270 {
lab=VdsMN1}
N 3300 -1570 3300 -1560 {
lab=Vdd}
N 3300 -1530 3330 -1530 {
lab=Vdd}
N 3330 -1570 3330 -1530 {
lab=Vdd}
N 3300 -1570 3330 -1570 {
lab=Vdd}
N 3300 -1490 3300 -1470 {
lab=VdMP2}
N 3280 -1490 3300 -1490 {
lab=VdMP2}
N 3330 -1580 3330 -1570 {
lab=Vdd}
N 3060 -1570 3060 -1560 {
lab=Vdd}
N 3060 -1530 3090 -1530 {
lab=Vdd}
N 3090 -1570 3090 -1530 {
lab=Vdd}
N 3060 -1570 3090 -1570 {
lab=Vdd}
N 3060 -1490 3060 -1470 {
lab=#net2}
N 3090 -1580 3090 -1570 {
lab=Vdd}
N 3190 -1550 3190 -1530 {
lab=VgMP1}
N 3000 -1530 3020 -1530 {
lab=#net2}
N 3000 -1530 3000 -1490 {
lab=#net2}
N 3300 -1410 3300 -1400 {
lab=VdMP1}
N 3060 -1410 3060 -1400 {
lab=VdMP1}
N 2090 -1420 2090 -1400 {
lab=VgMP2}
N 2020 -1290 2020 -1270 {
lab=VgMN2}
N 2490 -1290 2720 -1290 {
lab=VdsMN1}
N 3340 -1160 3400 -1160 {
lab=V_1}
N 3340 -1120 3370 -1120 {
lab=V_2}
N 3090 -1070 3090 -1050 {
lab=GND}
N 3280 -1230 3280 -1200 {
lab=Vdd}
N 3280 -1080 3280 -1050 {
lab=GND}
N 3150 -1050 3280 -1050 {
lab=GND}
N 2380 -1530 2450 -1530 {
lab=VgMP1}
N 2020 -1550 2020 -1530 {
lab=Vdd}
N 2490 -1500 2490 -1490 {
lab=VdMP1a}
N 2230 -1290 2310 -1290 {
lab=VdsMN1}
N 2190 -1490 2250 -1490 {
lab=#net1}
N 2250 -1500 2250 -1490 {
lab=#net1}
N 3190 -1530 3260 -1530 {
lab=VgMP1}
N 3300 -1500 3300 -1490 {
lab=VdMP2}
N 3000 -1490 3060 -1490 {
lab=#net2}
N 3060 -1500 3060 -1490 {
lab=#net2}
N 2490 -1400 2670 -1400 {
lab=VdMP1}
N 2910 -1570 2910 -1560 {
lab=Vdd}
N 2910 -1530 2940 -1530 {
lab=Vdd}
N 2940 -1570 2940 -1530 {
lab=Vdd}
N 2910 -1570 2940 -1570 {
lab=Vdd}
N 2910 -1490 2910 -1470 {
lab=VdMP1b}
N 2890 -1490 2910 -1490 {
lab=VdMP1b}
N 2940 -1580 2940 -1570 {
lab=Vdd}
N 2670 -1570 2670 -1560 {
lab=Vdd}
N 2670 -1530 2700 -1530 {
lab=Vdd}
N 2700 -1570 2700 -1530 {
lab=Vdd}
N 2670 -1570 2700 -1570 {
lab=Vdd}
N 2670 -1490 2670 -1470 {
lab=#net3}
N 2700 -1580 2700 -1570 {
lab=Vdd}
N 2800 -1550 2800 -1530 {
lab=VgMP1}
N 2610 -1530 2630 -1530 {
lab=#net3}
N 2610 -1530 2610 -1490 {
lab=#net3}
N 2910 -1410 2910 -1400 {
lab=VdMP1}
N 2670 -1400 2910 -1400 {
lab=VdMP1}
N 2670 -1410 2670 -1400 {
lab=VdMP1}
N 2800 -1530 2870 -1530 {
lab=VgMP1}
N 2910 -1500 2910 -1490 {
lab=VdMP1b}
N 2610 -1490 2670 -1490 {
lab=#net3}
N 2670 -1500 2670 -1490 {
lab=#net3}
N 3060 -1400 3300 -1400 {
lab=VdMP1}
N 2910 -1400 3060 -1400 {
lab=VdMP1}
N 2410 -1420 2410 -1400 {
lab=VdMP1}
N 2250 -1400 2410 -1400 {
lab=VdMP1}
N 3090 -1150 3090 -1130 {
lab=VCONT}
N 3090 -1150 3220 -1150 {
lab=VCONT}
N 3150 -1130 3220 -1130 {
lab=VCONT2}
N 3150 -1070 3150 -1050 {
lab=GND}
N 3090 -1050 3150 -1050 {
lab=GND}
C {vsource.sym} 2020 -1500 0 0 {name=V1 value=3.3 savecurrent=false}
C {ammeter.sym} 2490 -1440 0 0 {name=VIcont savecurrent=true spice_ignore=0}
C {gnd.sym} 2020 -1470 0 0 {name=l1 lab=GND}
C {vsource.sym} 2490 -1370 0 0 {name=VdMP1 value=0 savecurrent=false}
C {gnd.sym} 2490 -1340 0 0 {name=l2 lab=GND}
C {vsource.sym} 2090 -1500 0 0 {name=VgMP1 value=0 savecurrent=false}
C {gnd.sym} 2090 -1470 0 0 {name=l3 lab=GND}
C {vsource.sym} 2230 -1250 0 0 {name=VdMN1 value=3.3 savecurrent=false}
C {gnd.sym} 2230 -1220 0 0 {name=l4 lab=GND}
C {gnd.sym} 2340 -1140 0 0 {name=l5 lab=GND}
C {code.sym} 1750 -1150 0 0 {name=VCO_param_Paper only_toplevel=true spice_ignore=true
format="tcleval( @value )"
value="

.param w_MP1 = 4
.param l_MP1 = 7
.param w_MP2 = 8
.param l_MP2 = 4
.param w_MP3 = 5
.param l_MP3 = 4
.param w_MP4 = 5
.param l_MP4 = 5

.param w_MN1 = 5
.param l_MN1 = 0.5
.param w_MN2 = 5
.param l_MN2 = 0.5
.param w_MN3 = 3
.param l_MN3 = 0.5
.param w_MN4 = 2
.param l_MN4 = 5


"}
C {lab_wire.sym} 2470 -1490 0 0 {name=p1 sig_type=std_logic lab=VdMP1a}
C {lab_wire.sym} 2020 -1550 0 1 {name=p2 sig_type=std_logic lab=Vdd}
C {lab_wire.sym} 2520 -1580 0 1 {name=p3 sig_type=std_logic lab=Vdd}
C {lab_wire.sym} 2090 -1550 0 1 {name=p4 sig_type=std_logic lab=VgMP1}
C {devices/code.sym} 1630 -1010 0 0 {name=DCSim only_toplevel=false spice_ignore=0
value="
.save all


.csparam start = 10
.param Vcont = 1

.control

dc VdMP1 0 3.3 0.2 VgMP1 0 3.3 0.2
let IdMP1a = i(VIcont)
let IdMP1a_Diode = i(VIcont1) 
let  VsdMP1 = v(Vdd) - v(VdMP1) 
let VthMP1 = @n.xMP1.msky130_fd_pr__pfet_01v8[vth]
let  VovMP1a = v(Vdd) - v(VdMP1) - VthMP1  
*plot IdMP1a IdMP1a_Diode vs VsdMP1
*plot IdMP1a_Diode vs VovMP1

let IdMP1b = i(VIcont4)
let IdMP1b_Diode = i(VIcont5) 
let  VsdMP1 = v(Vdd) - v(VdMP1) 
let VthMP1 = @n.xMP1.msky130_fd_pr__pfet_01v8[vth]
let  VovMP1b = v(Vdd) - v(VdMP1) - VthMP1  
*plot IdMP1b IdMP1b_Diode vs VsdMP1
*plot IdMP1b_Diode vs VovMP1

let IdMP2 = i(VIcont2)
let IdMP2_Diode = i(VIcont3) 
let  VsdMP2 = v(Vdd) - v(VdMP2) 
let VthMP2 = @m.xMP4.msky130_fd_pr__pfet_01v8[vth]
let  VovMP2 = v(Vdd) - v(VdMP2) - VthMP2  
*plot IdMP2 IdMP2_Diode vs VsdMP2
*plot IdMP2_Diode vs VovMP2 
let KP1 = IdMP1_Diode/(VovMP1*VovMP1)
let AP1 = sqrt(KP1)
let KP2 = IdMP2_Diode/(VovMP2*VovMP2)
let AP2 = sqrt(KP2)

plot AP1 AP2

*plot IdMP1_Diode IdMP2_Diode vs VsdMP1
print VthMP1 VthMP2
*wrdata ../../sim_data/data_VCO_design.txt IdMP1_Diode VovMP1 IdMP1 vs VsdMP1
wrdata /workspaces/usm-vlsi-tools/shared_xserver/simulations/SKY130/IPD500-TimebasedDCDCBuck/sim_data/data_VCO_design.txt IdMP1_Diode VovMP1 IdMP1 vs VsdMP1
wrdata /workspaces/usm-vlsi-tools/shared_xserver/simulations/SKY130/IPD500-TimebasedDCDCBuck/sim_data/data_AP1_VthMP1.txt AP1 VthMP1 AP2 VthMP2

reset 
*load save_data.raw 
*show

dc VdMN1 0 3.3 0.2 VgMN1 0 3.3 0.2
let VdsMN1 = v(VdsMN1)
let IdMN1_Diode = i(VIdMN1)
let IdMN1 = i(VIdMN2)
let VthMN1 = @m.xMN1.msky130_fd_pr__nfet_01v8[vth]
let VovMN1 = VdsMN1 - VthMN1
*plot IdMN1 IdMN1_Diode vs VdsMN1
*plot IdMN1_Diode vs VovMN1

let VdsMN2 = v(VdsMN1)
let IdMN2_Diode = i(VIdMN3)
let IdMN2 = i(VIdMN4)
let VthMN2 = @m.xMN4.msky130_fd_pr__nfet_01v8[vth]
let VovMN2 = VdsMN2 - VthMN2
*plot IdMN2 IdMN2_Diode vs VdsMN2
*plot IdMN2_Diode vs VovMN2

let KN1 = IdMN1_Diode/(VovMN1*VovMN1)
let AN1 = sqrt(KN1)
let KN2 = IdMN2_Diode/(VovMN2*VovMN2)
let AN2 = sqrt(KN2)
*plot AN1 AN2
print VthMN1 VthMN2
wrdata /workspaces/usm-vlsi-tools/shared_xserver/simulations/SKY130/IPD500-TimebasedDCDCBuck/sim_data/data_AN1_VthMN1.txt AN1 VthMN1


reset

dc Vcont 0 2 0.1
*dc Vcont 0 3 0.1
let Icont = i(v.x1.x1.VIcont)
let Icont2 = i(v.x1.x1.VIcont1)
let Icont3 = i(v.x1.x1.VIcont3)
let VCN = v(x1.x1.VCN)
let VCP = v(x1.x1.VCP)
let Vsg_MP3 = v(Vdd) - VCP
let VsdMP3 = v(VDD) - v(x1.x1.VSMP4)
let VdsMN3 = v(x1.x1.VdsMN3)


plot Icont Icont2 Icont3 vs Vcont
plot Icont3 vs Vcont
plot Icont3 vs VCP
plot VCP vs Vcont
plot VCN Vsg_MP3 vs Vcont
plot VsdMP3 VdsMN3 vs Vcont
*plot Vin vs Vcont
.endc

"}
C {lab_wire.sym} 2310 -1300 0 0 {name=p5 sig_type=std_logic lab=VdsMN1}
C {ammeter.sym} 2340 -1260 0 0 {name=VIdMN1 savecurrent=true spice_ignore=0}
C {lab_wire.sym} 2380 -1550 0 1 {name=p7 sig_type=std_logic lab=VgMP1}
C {ammeter.sym} 2250 -1440 0 0 {name=VIcont1 savecurrent=true spice_ignore=0}
C {lab_wire.sym} 2280 -1580 0 1 {name=p9 sig_type=std_logic lab=Vdd}
C {gnd.sym} 2490 -1120 0 0 {name=l10 lab=GND}
C {ammeter.sym} 2490 -1240 0 0 {name=VIdMN2 savecurrent=true spice_ignore=0}
C {lab_wire.sym} 2550 -1180 0 1 {name=p8 sig_type=std_logic lab=VgMN1}
C {vsource.sym} 2020 -1370 0 0 {name=VgMN1 value=3.3 savecurrent=false}
C {gnd.sym} 2020 -1340 0 0 {name=l11 lab=GND}
C {lab_wire.sym} 2020 -1420 0 1 {name=p10 sig_type=std_logic lab=VgMN1}
C {gnd.sym} 2750 -1140 0 0 {name=l7 lab=GND}
C {ammeter.sym} 2750 -1260 0 0 {name=VIdMN3 savecurrent=true spice_ignore=0}
C {gnd.sym} 2900 -1120 0 0 {name=l8 lab=GND}
C {ammeter.sym} 2900 -1240 0 0 {name=VIdMN4 savecurrent=true spice_ignore=0}
C {lab_wire.sym} 2960 -1180 0 1 {name=p12 sig_type=std_logic lab=VgMN1}
C {ammeter.sym} 3300 -1440 0 0 {name=VIcont2 savecurrent=true spice_ignore=0}
C {lab_wire.sym} 3280 -1490 0 0 {name=p6 sig_type=std_logic lab=VdMP2}
C {lab_wire.sym} 3330 -1580 0 1 {name=p13 sig_type=std_logic lab=Vdd}
C {lab_wire.sym} 3190 -1550 0 1 {name=p14 sig_type=std_logic lab=VgMP1}
C {ammeter.sym} 3060 -1440 0 0 {name=VIcont3 savecurrent=true spice_ignore=0}
C {lab_wire.sym} 3090 -1580 0 1 {name=p15 sig_type=std_logic lab=Vdd}
C {vsource.sym} 2090 -1370 0 0 {name=VgMP2 value=3.3 savecurrent=false}
C {gnd.sym} 2090 -1340 0 0 {name=l12 lab=GND}
C {lab_wire.sym} 2090 -1420 0 1 {name=p16 sig_type=std_logic lab=VgMP2}
C {vsource.sym} 2020 -1240 0 0 {name=VgMN2 value=3.3 savecurrent=false}
C {gnd.sym} 2020 -1210 0 0 {name=l13 lab=GND}
C {lab_wire.sym} 2020 -1290 0 1 {name=p17 sig_type=std_logic lab=VgMN2}
C {devices/lab_pin.sym} 3090 -1150 1 0 {name=p11 sig_type=std_logic lab=VCONT}
C {devices/lab_pin.sym} 3370 -1160 1 0 {name=p18 sig_type=std_logic lab=V_1}
C {devices/lab_pin.sym} 3370 -1120 1 0 {name=p19 sig_type=std_logic lab=V_2}
C {vsource.sym} 3090 -1100 0 1 {name=Vcont value=\{Vcont\} savecurrent=false}
C {devices/lab_pin.sym} 3280 -1230 1 0 {name=p21 sig_type=std_logic lab=Vdd}
C {gnd.sym} 3150 -1050 0 0 {name=l6 lab=GND}
C {sg13g2_pr/sg13_hv_pmos.sym} 2230 -1530 0 0 {name=MP1a
l=\{l_MP1a\}
w=\{w_MP1a\}
ng=1
m=1
model=sg13_hv_pmos
spiceprefix=X
}
C {sg13g2_pr/sg13_hv_pmos.sym} 2470 -1530 0 0 {name=MP1
l=\{l_MP1a\}
w=\{w_MP1a\}
ng=1
m=1
model=sg13_hv_pmos
spiceprefix=X
}
C {sg13g2_pr/sg13_hv_pmos.sym} 3040 -1530 0 0 {name=MP3
l=\{l_MP2\}
w=\{w_MP2\}
ng=1
m=1
model=sg13_hv_pmos
spiceprefix=X
}
C {sg13g2_pr/sg13_hv_pmos.sym} 3280 -1530 0 0 {name=MP2
l=\{l_MP2\}
w=\{w_MP2\}
ng=1
m=1
model=sg13_hv_pmos
spiceprefix=X
}
C {sg13g2_pr/sg13_hv_nmos.sym} 2360 -1200 2 0 {name=MN5
l=\{l_MN1\}
w=\{w_MN1\}
ng=1
m=1
model=sg13_hv_nmos
spiceprefix=X
}
C {sg13g2_pr/sg13_hv_nmos.sym} 2510 -1180 2 0 {name=MN1
l=\{l_MN1\}
w=\{w_MN1\}
ng=1
m=1
model=sg13_hv_nmos
spiceprefix=X
}
C {sg13g2_pr/sg13_hv_nmos.sym} 2770 -1200 2 0 {name=MN3
l=\{l_MN2\}
w=\{w_MN2\}
ng=1
m=1
model=sg13_hv_nmos
spiceprefix=X
}
C {sg13g2_pr/sg13_hv_nmos.sym} 2920 -1180 2 0 {name=MN2
l=\{l_MN2\}
w=\{w_MN2\}
ng=1
m=1
model=sg13_hv_nmos
spiceprefix=X
}
C {code.sym} 1750 -1010 0 0 {name=VCO_param_Ki_2.14M/V only_toplevel=true spice_ignore=1
format="tcleval( @value )"
value="

.param Vcont2 = 1.8

.param w_MP1a = 2u
.param l_MP1a = 7u
.param w_MP1b = 3u
.param l_MP1b = 7u
.param w_MP2 = 8u
.param l_MP2 = 4u
.param w_MP3 = 5u
.param l_MP3 = 4u
.param w_MP4 = 5u
.param l_MP4 = 5u

.param w_MN1 = 5u
.param l_MN1 = 0.5u
.param w_MN2 = 5u
.param l_MN2 = 0.5u
.param w_MN3 = 3u
.param l_MN3 = 0.5u
.param w_MN4 = 2u
.param l_MN4 = 5u



"}
C {code.sym} 1640 -1150 0 0 {name=MODEL only_toplevel=true
format="tcleval( @value )"
value="

.lib cornerMOShv.lib mos_tt
.lib cornerMOSlv.lib mos_tt
*.lib cornerMOShv.lib mos_ff
*.lib cornerMOSlv.lib mos_ff
*.lib cornerMOShv.lib mos_ss
*.lib cornerMOSlv.lib mos_ss
*.lib cornerMOShv.lib mos_sf
*.lib cornerMOSlv.lib mos_sf
*.lib cornerMOShv.lib mos_fs
*.lib cornerMOSlv.lib mos_fs

*.include /opt/pdks/ihp-sg13g2/libs.ref/sg13g2_stdcell/spice/sg13g2_stdcell.spice
*.lib $::SG13G2_MODELS/cornerRES.lib res_typ
*.lib $::SG13G2_MODELS/cornerCAP.lib cap_typ
*.lib $::SG13G2_MODELS/diodes.lib
"}
C {ammeter.sym} 2910 -1440 0 0 {name=VIcont4 savecurrent=true spice_ignore=0}
C {lab_wire.sym} 2890 -1490 0 0 {name=p20 sig_type=std_logic lab=VdMP1b}
C {lab_wire.sym} 2940 -1580 0 1 {name=p22 sig_type=std_logic lab=Vdd}
C {lab_wire.sym} 2800 -1550 0 1 {name=p23 sig_type=std_logic lab=VgMP1}
C {ammeter.sym} 2670 -1440 0 0 {name=VIcont5 savecurrent=true spice_ignore=0}
C {lab_wire.sym} 2700 -1580 0 1 {name=p24 sig_type=std_logic lab=Vdd}
C {sg13g2_pr/sg13_hv_pmos.sym} 2650 -1530 0 0 {name=MP4
l=\{l_MP1b\}
w=\{w_MP1b\}
ng=1
m=1
model=sg13_hv_pmos
spiceprefix=X
}
C {sg13g2_pr/sg13_hv_pmos.sym} 2890 -1530 0 0 {name=MP5
l=\{l_MP1b\}
w=\{w_MP1b\}
ng=1
m=1
model=sg13_hv_pmos
spiceprefix=X
}
C {lab_wire.sym} 2410 -1420 0 0 {name=p25 sig_type=std_logic lab=VdMP1}
C {launcher.sym} 2070 -1080 0 0 {name=h1
descr="Annotate OP" 
*tclcommand="set show_hidden_texts 1; xschem annotate_op"
tclcommand="xschem annotate_op"}
C {code.sym} 1950 -1010 0 0 {name=VCO_param_Ki_2.34M/V_fo_3.66MHz only_toplevel=true spice_ignore=1
format="tcleval( @value )"
value="

.param Vcont2 = 1.8

.param w_MP1a = 2u
.param l_MP1a = 7u
.param w_MP1b = 3u
.param l_MP1b = 7u
.param w_MP2 = 8u
.param l_MP2 = 4u
.param w_MP3 = 5u
.param l_MP3 = 4u
.param w_MP4 = 5u
.param l_MP4 = 5u

.param w_MN1 = 5u
.param l_MN1 = 0.5u
.param w_MN2 = 5u
.param l_MN2 = 0.5u
.param w_MN3 = 3u
.param l_MN3 = 0.5u
.param w_MN4 = 2u
.param l_MN4 = 5u



"}
C {/workspaces/usm-vlsi-tools/shared_xserver/simulations/Projects/IHP/IPD500_TD_Buck/xschem/VCO/VCO_V1.sym} 3280 -1140 0 0 {name=x1}
C {vsource.sym} 3150 -1100 0 0 {name=Vcont2 value=\{Vcont2\} savecurrent=false}
C {code.sym} 2270 -1010 0 0 {name=VCO_param_Ki_1 only_toplevel=true spice_ignore=1
format="tcleval( @value )"
value="

.param Vcont2 = 1.8

.param w_MP1a =0.5u
.param l_MP1a = 8u
.param w_MP1b = 3u
.param l_MP1b = 7u
.param w_MP2 = 8u
.param l_MP2 = 1u
.param w_MP3 = 8u
.param l_MP3 = 1u
.param w_MP4 = 0.5u
.param l_MP4 = 6u

.param w_MN1 = 6u
.param l_MN1 = 0.5u
.param w_MN2 = 6u
.param l_MN2 = 0.5u
.param w_MN3 = 2u
.param l_MN3 = 1u
.param w_MN4 = 0.5u
.param l_MN4 = 6u



"}
C {devices/lab_pin.sym} 3190 -1130 1 1 {name=p26 sig_type=std_logic lab=VCONT2}
C {code.sym} 2420 -1010 0 0 {name=VCO_param_Ki_Sym_VCN_VCP only_toplevel=true spice_ignore=1
format="tcleval( @value )"
value="

.param Vcont2 = 1.8

.param w_MP1a =0.5u
.param l_MP1a = 8u
.param w_MP1b = 3u
.param l_MP1b = 7u
.param w_MP2 = 8u
.param l_MP2 = 1u
.param w_MP3 = 8u
.param l_MP3 = 1u
.param w_MP4 = 0.5u
.param l_MP4 = 6u

.param w_MN1 = 2u
.param l_MN1 = 1u
.param w_MN2 = 2u
.param l_MN2 = 1u
.param w_MN3 = 2u
.param l_MN3 = 1u
.param w_MN4 = 0.5u
.param l_MN4 = 6u



"}
C {code.sym} 2670 -1010 0 0 {name=VCO_param_Symtr__Ki_0.958M/V_fo_2.749MHz only_toplevel=true spice_ignore=1
format="tcleval( @value )"
value="

.param Vcont2 = 1.8

.param w_MP1a =1u
.param l_MP1a = 8u
.param w_MP1b = 3u
.param l_MP1b = 8u
.param w_MP2 = 7u
.param l_MP2 = 1u
.param w_MP3 = 8u
.param l_MP3 = 1u
.param w_MP4 = 2u
.param l_MP4 = 10u

.param w_MN1 = 2u
.param l_MN1 = 1u
.param w_MN2 = 1u
.param l_MN2 = 1u
.param w_MN3 = 2u
.param l_MN3 = 1u
.param w_MN4 = 0.5u
.param l_MN4 = 10u



"}
C {code.sym} 1740 -860 0 0 {name=VCO_param_Paper1 only_toplevel=true spice_ignore=0
format="tcleval( @value )"
value="
.param Vcont2 = 3.3

.param w_MP1a = 4u
.param l_MP1a = 7u
.param w_MP1b = 4u
.param l_MP1b = 7u
.param w_MP2 = 8u
.param l_MP2 = 4u
.param w_MP3 = 5u
.param l_MP3 = 4u
.param w_MP4 = 5u
.param l_MP4 = 5u

.param w_MN1 = 5u
.param l_MN1 = 0.5u
.param w_MN2 = 5u
.param l_MN2 = 0.5u
.param w_MN3 = 3u
.param l_MN3 = 0.5u
.param w_MN4 = 2u
.param l_MN4 = 5u


"}
C {devices/code.sym} 1630 -860 0 0 {name=OP_Sim only_toplevel=false spice_ignore=0
value="
.save all
.param Vcont = 1

.control
reset
unset filetype
op
alter Vcont 1
let VCN = v(x1.x1.VCN)
let VCP = v(x1.x1.VCP)

let Vsd_MP4 = v(x1.x1.VSMP4) - v(x1.x1.VOUT)
let Vsd_MP3 = v(VDD) - v(x1.x1.VSMP4)
let Vsd_MP2 = v(VDD) - v(x1.x1.VCP)
let Vsd_MP1 = v(VDD) - VCN
let Vds_MN4 = v(x1.x1.VOUT) - v(x1.x1.VdsMN3)

let Vth_MP1a = @n.x1.x1.xmp1a.nsg13_hv_pmos[vth]
let Vth_MP1b = @n.x1.x1.xmp1b.nsg13_hv_pmos[vth]
let Vth_MP2 = @n.x1.x1.xmp2.nsg13_hv_pmos[vth]
let Vth_MP3 = @n.x1.x1.xmp3.nsg13_hv_pmos[vth]
let Vth_MP4 = @n.x1.x1.xmp3.nsg13_hv_pmos[vth]
let Vth_MN1 = @n.x1.x1.xmn1.nsg13_hv_nmos[vth]
let Vth_MN2 = @n.x1.x1.xmn2.nsg13_hv_nmos[vth]
let Vth_MN3 = @n.x1.x1.xmn3.nsg13_hv_nmos[vth]
let Vth_MN4 = @n.x1.x1.xmn4.nsg13_hv_nmos[vth]

let Vsg_MP4 = v(x1.x1.VSMP4) - v(x1.x1.VIN)
let Vsg_MP3 = v(VDD) - VCP
let Vsg_MP1a = v(VDD) - v(VCONT)
let Vsg_MP1b = v(VDD) - v(VCONT2)
let Vgs_MN4 = v(x1.x1.VIN) - v(x1.x1.VdsMN3)

let Vov_MP1a = Vsg_MP1a - Vth_MP1a 
let Vov_MP1b = Vsg_MP1b - Vth_MP1b
let Vov_MP3 = Vsg_MP3 - Vth_MP3
let Vov_MP4 = Vsg_MP4 - Vth_MP4
let Vov_MN2 =  VCN - Vth_MN2
let Vov_MN3 =  VCN - Vth_MN3
let Vov_MN4 =  VCN - Vth_MN4

let gds_MN3 = @n.x1.x1.xmn3.nsg13_hv_nmos[gds]
let Ron_MN3 = 1/gds_MN3
let gds_MP3 = @n.x1.x1.xmp3.nsg13_hv_pmos[gds]
let Ron_MP3 = 1/gds_MP3

 
write TB_VCO_Design_V1.raw
.endc

"}
